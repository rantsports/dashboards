<!DOCTYPE html>
<html lang="ru" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sprint Performance Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class'
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .chart-container {
            position: relative;
            height: 350px;
        }
        .filter-chip {
            transition: all 0.2s ease;
        }
        .filter-chip.active {
            background-color: #3b82f6;
            color: white;
        }
        .filter-chip:hover {
            transform: translateY(-1px);
        }
        /* Dark mode chart background */
        .dark canvas {
            filter: none;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen transition-colors duration-200">
    <!-- Header -->
    <header class="bg-white dark:bg-gray-800 shadow-sm border-b dark:border-gray-700 transition-colors">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Sprint Performance Dashboard</h1>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Teams Performance</p>
                </div>
                <div class="flex items-center gap-4">
                    <!-- Theme Toggle -->
                    <button id="themeToggle" onclick="toggleTheme()" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors" title="Переключить тему">
                        <svg id="sunIcon" class="w-5 h-5 text-gray-600 dark:text-gray-300 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                        </svg>
                        <svg id="moonIcon" class="w-5 h-5 text-gray-600 dark:text-gray-300 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                        </svg>
                    </button>
                    <div class="text-right text-sm text-gray-500 dark:text-gray-400">
                        <p>Последнее обновление данных:</p>
                        <p class="font-medium" id="lastUpdate">31 января 2026</p>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Filters -->
    <div class="bg-white dark:bg-gray-800 border-b dark:border-gray-700 sticky top-0 z-10 transition-colors">
        <div class="max-w-7xl mx-auto px-4 py-3">
            <div class="flex flex-wrap gap-4 items-center">
                <!-- Team Filter -->
                <div class="flex-1 min-w-[300px]">
                    <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">Команды</label>
                    <div id="teamFilters" class="flex flex-wrap gap-1">
                        <!-- Generated by JS -->
                    </div>
                </div>
                
                <!-- Sprint Range Filter -->
                <div class="min-w-[300px]">
                    <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">Диапазон спринтов</label>
                    <div class="flex items-center gap-2">
                        <select id="sprintFrom" class="border dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded px-2 py-1 text-sm">
                            <!-- Generated by JS -->
                        </select>
                        <span class="text-gray-400">—</span>
                        <select id="sprintTo" class="border dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded px-2 py-1 text-sm">
                            <!-- Generated by JS -->
                        </select>
                    </div>
                </div>
                
                <!-- Reset Button -->
                <button onclick="resetFilters()" class="px-3 py-1 text-sm bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 dark:text-white rounded transition">
                    Сбросить
                </button>
            </div>
        </div>
    </div>

    <!-- Summary Cards -->
    <div class="max-w-7xl mx-auto px-4 py-4">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow dark:shadow-gray-900 p-4 transition-colors">
                <p class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide">Всего спринтов</p>
                <p class="text-2xl font-bold text-gray-900 dark:text-white" id="totalSprints">-</p>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow dark:shadow-gray-900 p-4 transition-colors">
                <p class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide">Средний % выполнения</p>
                <p class="text-2xl font-bold text-blue-600 dark:text-blue-400" id="avgCompletion">-</p>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow dark:shadow-gray-900 p-4 transition-colors">
                <p class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide">Всего закрыто SP</p>
                <p class="text-2xl font-bold text-green-600 dark:text-green-400" id="totalConfirmed">-</p>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow dark:shadow-gray-900 p-4 transition-colors">
                <p class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide">Средний Velocity</p>
                <p class="text-2xl font-bold text-purple-600 dark:text-purple-400" id="avgVelocity">-</p>
            </div>
        </div>

        <!-- Charts Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Velocity Chart -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow dark:shadow-gray-900 p-4 transition-colors">
                <h3 class="text-lg font-semibold mb-4 text-gray-900 dark:text-white">Закрытые стори поинты по спринтам</h3>
                <div class="chart-container">
                    <canvas id="velocityChart"></canvas>
                </div>
            </div>

            <!-- Completion Rate Chart -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow dark:shadow-gray-900 p-4 transition-colors">
                <h3 class="text-lg font-semibold mb-4 text-gray-900 dark:text-white">Процент выполнения по спринтам</h3>
                <div class="chart-container">
                    <canvas id="completionChart"></canvas>
                </div>
            </div>

            <!-- Trend Chart -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow dark:shadow-gray-900 p-4 transition-colors">
                <h3 class="text-lg font-semibold mb-4 text-gray-900 dark:text-white">Сумма закрытых стори поинтов</h3>
                <div class="chart-container">
                    <canvas id="trendChart"></canvas>
                </div>
            </div>

            <!-- Team Comparison Chart -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow dark:shadow-gray-900 p-4 transition-colors">
                <h3 class="text-lg font-semibold mb-4 text-gray-900 dark:text-white">Средний процент выполнения по командам</h3>
                <div class="chart-container">
                    <canvas id="teamComparisonChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="max-w-7xl mx-auto px-4 py-6 text-center text-sm text-gray-500 dark:text-gray-400">
        <p>Данные из <a href="https://docs.google.com/spreadsheets/d/1Sunl7PgMGB89Lq5dI4GAKLzrOIalKoqEuYTAdl4PQu0/edit" target="_blank" class="text-blue-600 dark:text-blue-400 hover:underline">Google Sheets: Teams Performance 2025</a></p>
    </footer>

    <script>
        // ============================================
        // EMBEDDED DATA FROM GOOGLE SHEETS
        // Only records with non-empty Analytic Team field
        // Sprint ID includes year for uniqueness
        // ============================================
        const RAW_DATA = [
            // 2025 Sprint 01
            {"sprintId":"2025-01","sprintLabel":"2025 Sprint 01","team":"B2B - Technology","committed":193,"confirmed":89,"percent":0.4611,"date":"2025-01-24"},
            {"sprintId":"2025-01","sprintLabel":"2025 Sprint 01","team":"Technology - Sport Fan Engagement","committed":165,"confirmed":131,"percent":0.62,"date":"2025-01-24"},
            {"sprintId":"2025-01","sprintLabel":"2025 Sprint 01","team":"Technology - Monetization","committed":143,"confirmed":131,"percent":0.92,"date":"2025-01-24"},
            // 2025 Sprint 02
            {"sprintId":"2025-02","sprintLabel":"2025 Sprint 02","team":"B2B - Technology","committed":258,"confirmed":125,"percent":0.4845,"date":"2025-02-07"},
            {"sprintId":"2025-02","sprintLabel":"2025 Sprint 02","team":"Technology - Sport Fan Engagement","committed":154,"confirmed":75,"percent":0.49,"date":"2025-02-07"},
            {"sprintId":"2025-02","sprintLabel":"2025 Sprint 02","team":"Technology - Monetization","committed":216,"confirmed":49,"percent":0.23,"date":"2025-02-07"},
            {"sprintId":"2025-02","sprintLabel":"2025 Sprint 02","team":"Technology - SEO","committed":56,"confirmed":65,"percent":0.53,"date":"2025-04-07"},
            // 2025 Sprint 03
            {"sprintId":"2025-03","sprintLabel":"2025 Sprint 03","team":"B2B - Technology","committed":249,"confirmed":185,"percent":0.743,"date":"2025-02-21"},
            {"sprintId":"2025-03","sprintLabel":"2025 Sprint 03","team":"Technology - Sport Fan Engagement","committed":278,"confirmed":100,"percent":0.36,"date":"2025-02-21"},
            {"sprintId":"2025-03","sprintLabel":"2025 Sprint 03","team":"Technology - SEO","committed":83,"confirmed":85,"percent":0.53,"date":"2025-02-21"},
            {"sprintId":"2025-03","sprintLabel":"2025 Sprint 03","team":"Technology - Monetization","committed":488,"confirmed":261,"percent":0.53,"date":"2025-02-21"},
            // 2025 Sprint 04
            {"sprintId":"2025-04","sprintLabel":"2025 Sprint 04","team":"B2B - Technology","committed":347,"confirmed":254,"percent":0.732,"date":"2025-03-07"},
            {"sprintId":"2025-04","sprintLabel":"2025 Sprint 04","team":"Technology - Sport Fan Engagement","committed":307,"confirmed":186,"percent":0.6,"date":"2025-03-07"},
            {"sprintId":"2025-04","sprintLabel":"2025 Sprint 04","team":"Technology - SEO","committed":131,"confirmed":39,"percent":0.3,"date":"2025-03-07"},
            {"sprintId":"2025-04","sprintLabel":"2025 Sprint 04","team":"Technology - Monetization","committed":372,"confirmed":220,"percent":0.59,"date":"2025-03-07"},
            // 2025 Sprint 05
            {"sprintId":"2025-05","sprintLabel":"2025 Sprint 05","team":"B2B - Technology","committed":568,"confirmed":414,"percent":0.7289,"date":"2025-03-21"},
            {"sprintId":"2025-05","sprintLabel":"2025 Sprint 05","team":"Technology - Sport Fan Engagement","committed":179,"confirmed":89,"percent":0.49,"date":"2025-03-21"},
            {"sprintId":"2025-05","sprintLabel":"2025 Sprint 05","team":"Technology - SEO","committed":137,"confirmed":85,"percent":0.62,"date":"2025-03-21"},
            {"sprintId":"2025-05","sprintLabel":"2025 Sprint 05","team":"Technology - Monetization","committed":384,"confirmed":290,"percent":0.75,"date":"2025-03-21"},
            // 2025 Sprint 06
            {"sprintId":"2025-06","sprintLabel":"2025 Sprint 06","team":"B2B - Technology","committed":396,"confirmed":274,"percent":0.6919,"date":"2025-04-04"},
            {"sprintId":"2025-06","sprintLabel":"2025 Sprint 06","team":"Technology - Sport Fan Engagement","committed":259,"confirmed":98,"percent":0.38,"date":"2025-04-04"},
            {"sprintId":"2025-06","sprintLabel":"2025 Sprint 06","team":"Technology - SEO","committed":217,"confirmed":134,"percent":0.62,"date":"2025-04-04"},
            {"sprintId":"2025-06","sprintLabel":"2025 Sprint 06","team":"Technology - Monetization","committed":277,"confirmed":175,"percent":0.63,"date":"2025-04-04"},
            // 2025 Sprint 07
            {"sprintId":"2025-07","sprintLabel":"2025 Sprint 07","team":"B2B - Technology","committed":502,"confirmed":369,"percent":0.7351,"date":"2025-04-18"},
            {"sprintId":"2025-07","sprintLabel":"2025 Sprint 07","team":"Technology - Sport Fan Engagement","committed":175,"confirmed":94,"percent":0.54,"date":"2025-04-18"},
            {"sprintId":"2025-07","sprintLabel":"2025 Sprint 07","team":"Technology - SEO","committed":125,"confirmed":54,"percent":0.43,"date":"2025-04-18"},
            {"sprintId":"2025-07","sprintLabel":"2025 Sprint 07","team":"Technology - Monetization","committed":347,"confirmed":205,"percent":0.59,"date":"2025-04-18"},
            // 2025 Sprint 08
            {"sprintId":"2025-08","sprintLabel":"2025 Sprint 08","team":"B2B - Technology","committed":309,"confirmed":162,"percent":0.5243,"date":"2025-04-30"},
            {"sprintId":"2025-08","sprintLabel":"2025 Sprint 08","team":"Technology - Sport Fan Engagement","committed":176,"confirmed":170,"percent":0.97,"date":"2025-04-30"},
            {"sprintId":"2025-08","sprintLabel":"2025 Sprint 08","team":"Technology - SEO","committed":129,"confirmed":90,"percent":0.7,"date":"2025-04-30"},
            {"sprintId":"2025-08","sprintLabel":"2025 Sprint 08","team":"Technology - Monetization","committed":347,"confirmed":258,"percent":0.74,"date":"2025-04-30"},
            // 2025 Sprint 09
            {"sprintId":"2025-09","sprintLabel":"2025 Sprint 09","team":"B2B - Technology","committed":305,"confirmed":189,"percent":0.6197,"date":"2025-05-23"},
            {"sprintId":"2025-09","sprintLabel":"2025 Sprint 09","team":"Technology - Sport Fan Engagement","committed":143,"confirmed":96,"percent":0.43,"date":"2025-05-23"},
            {"sprintId":"2025-09","sprintLabel":"2025 Sprint 09","team":"Technology - SEO","committed":266,"confirmed":185,"percent":0.7,"date":"2025-05-23"},
            {"sprintId":"2025-09","sprintLabel":"2025 Sprint 09","team":"Technology - Monetization","committed":343,"confirmed":151,"percent":0.44,"date":"2025-05-23"},
            // 2025 Sprint 10
            {"sprintId":"2025-10","sprintLabel":"2025 Sprint 10","team":"B2B - Technology","committed":384,"confirmed":139,"percent":0.362,"date":"2025-06-06"},
            {"sprintId":"2025-10","sprintLabel":"2025 Sprint 10","team":"Technology - Sport Fan Engagement","committed":190,"confirmed":68,"percent":0.29,"date":"2025-06-06"},
            {"sprintId":"2025-10","sprintLabel":"2025 Sprint 10","team":"Technology - SEO","committed":211,"confirmed":96,"percent":0.45,"date":"2025-06-06"},
            {"sprintId":"2025-10","sprintLabel":"2025 Sprint 10","team":"Technology - Monetization","committed":387,"confirmed":134,"percent":0.35,"date":"2025-06-06"},
            // 2025 Sprint 11
            {"sprintId":"2025-11","sprintLabel":"2025 Sprint 11","team":"B2B - Technology","committed":254,"confirmed":210,"percent":0.8268,"date":"2025-06-20"},
            {"sprintId":"2025-11","sprintLabel":"2025 Sprint 11","team":"Technology - Sport Fan Engagement","committed":117,"confirmed":93,"percent":0.44,"date":"2025-06-20"},
            {"sprintId":"2025-11","sprintLabel":"2025 Sprint 11","team":"Technology - SEO","committed":236,"confirmed":86,"percent":0.35,"date":"2025-06-20"},
            {"sprintId":"2025-11","sprintLabel":"2025 Sprint 11","team":"Technology - Monetization","committed":339,"confirmed":324,"percent":0.96,"date":"2025-06-20"},
            // 2025 Sprint 12
            {"sprintId":"2025-12","sprintLabel":"2025 Sprint 12","team":"B2B - Technology","committed":383,"confirmed":247,"percent":0.6449,"date":"2025-07-04"},
            {"sprintId":"2025-12","sprintLabel":"2025 Sprint 12","team":"Technology - Sport Fan Engagement","committed":95,"confirmed":143,"percent":0.64,"date":"2025-07-04"},
            {"sprintId":"2025-12","sprintLabel":"2025 Sprint 12","team":"Technology - SEO","committed":232,"confirmed":60,"percent":0.26,"date":"2025-07-04"},
            {"sprintId":"2025-12","sprintLabel":"2025 Sprint 12","team":"Technology - Monetization","committed":191,"confirmed":98,"percent":0.51,"date":"2025-07-04"},
            // 2025 Sprint 13
            {"sprintId":"2025-13","sprintLabel":"2025 Sprint 13","team":"B2B - Technology","committed":321,"confirmed":181,"percent":0.5639,"date":"2025-07-18"},
            {"sprintId":"2025-13","sprintLabel":"2025 Sprint 13","team":"Technology - Sport Fan Engagement","committed":225,"confirmed":90,"percent":0.4,"date":"2025-07-18"},
            {"sprintId":"2025-13","sprintLabel":"2025 Sprint 13","team":"Technology - SEO","committed":226,"confirmed":50,"percent":0.22,"date":"2025-07-18"},
            {"sprintId":"2025-13","sprintLabel":"2025 Sprint 13","team":"Technology - Monetization","committed":322,"confirmed":322,"percent":1,"date":"2025-07-18"},
            // 2025 Sprint 14
            {"sprintId":"2025-14","sprintLabel":"2025 Sprint 14","team":"Technology - Sport Fan Engagement","committed":255,"confirmed":111,"percent":0.4353,"date":"2025-07-21"},
            {"sprintId":"2025-14","sprintLabel":"2025 Sprint 14","team":"Technology - SEO","committed":190,"confirmed":85,"percent":0.4474,"date":"2025-07-21"},
            {"sprintId":"2025-14","sprintLabel":"2025 Sprint 14","team":"Technology - Monetization","committed":522,"confirmed":378,"percent":1,"date":"2025-07-21"},
            // 2025 Sprint 15
            {"sprintId":"2025-15","sprintLabel":"2025 Sprint 15","team":"B2B - Technology","committed":309,"confirmed":194,"percent":0.6278,"date":"2025-08-04"},
            {"sprintId":"2025-15","sprintLabel":"2025 Sprint 15","team":"Technology - Sport Fan Engagement","committed":255,"confirmed":111,"percent":0.4353,"date":"2025-08-04"},
            {"sprintId":"2025-15","sprintLabel":"2025 Sprint 15","team":"Technology - Monetization","committed":242,"confirmed":242,"percent":1,"date":"2025-08-04"},
            // 2025 Sprint 16
            {"sprintId":"2025-16","sprintLabel":"2025 Sprint 16","team":"B2B - Technology","committed":242,"confirmed":186,"percent":0.7686,"date":"2025-08-18"},
            {"sprintId":"2025-16","sprintLabel":"2025 Sprint 16","team":"Technology - Sport Fan Engagement","committed":175,"confirmed":107,"percent":0.6114,"date":"2025-08-18"},
            {"sprintId":"2025-16","sprintLabel":"2025 Sprint 16","team":"Technology - Monetization","committed":242,"confirmed":242,"percent":1,"date":"2025-08-18"},
            // 2025 Sprint 17
            {"sprintId":"2025-17","sprintLabel":"2025 Sprint 17","team":"B2B - Technology","committed":255,"confirmed":184,"percent":0.7216,"date":"2025-09-01"},
            {"sprintId":"2025-17","sprintLabel":"2025 Sprint 17","team":"Technology - Sport Fan Engagement","committed":275,"confirmed":228,"percent":0.8291,"date":"2025-09-01"},
            {"sprintId":"2025-17","sprintLabel":"2025 Sprint 17","team":"Technology - SEO","committed":197,"confirmed":39,"percent":0.198,"date":"2025-09-01"},
            {"sprintId":"2025-17","sprintLabel":"2025 Sprint 17","team":"Technology - Monetization","committed":304,"confirmed":298,"percent":0.9803,"date":"2025-09-01"},
            // 2025 Sprint 18
            {"sprintId":"2025-18","sprintLabel":"2025 Sprint 18","team":"B2B - Technology","committed":305,"confirmed":229,"percent":0.7508,"date":"2025-09-15"},
            {"sprintId":"2025-18","sprintLabel":"2025 Sprint 18","team":"Technology - Sport Fan Engagement","committed":223,"confirmed":197,"percent":0.8834,"date":"2025-09-15"},
            {"sprintId":"2025-18","sprintLabel":"2025 Sprint 18","team":"Technology - SEO","committed":74,"confirmed":0,"percent":0,"date":"2025-09-15"},
            {"sprintId":"2025-18","sprintLabel":"2025 Sprint 18","team":"Technology - Monetization","committed":122,"confirmed":122,"percent":1,"date":"2025-09-15"},
            // 2025 Sprint 19
            {"sprintId":"2025-19","sprintLabel":"2025 Sprint 19","team":"B2B - Technology","committed":365,"confirmed":243,"percent":0.6658,"date":"2025-09-29"},
            {"sprintId":"2025-19","sprintLabel":"2025 Sprint 19","team":"Technology - Sport Fan Engagement","committed":217,"confirmed":126,"percent":0.5806,"date":"2025-09-29"},
            {"sprintId":"2025-19","sprintLabel":"2025 Sprint 19","team":"Technology - SEO","committed":166,"confirmed":16,"percent":0.0964,"date":"2025-09-29"},
            {"sprintId":"2025-19","sprintLabel":"2025 Sprint 19","team":"Technology - Monetization","committed":114,"confirmed":109,"percent":0.9561,"date":"2025-09-29"},
            // 2025 Sprint 20
            {"sprintId":"2025-20","sprintLabel":"2025 Sprint 20","team":"B2B - Technology","committed":237,"confirmed":65,"percent":0.2743,"date":"2025-10-13"},
            {"sprintId":"2025-20","sprintLabel":"2025 Sprint 20","team":"Technology - Sport Fan Engagement","committed":194,"confirmed":147,"percent":0.7577,"date":"2025-10-13"},
            {"sprintId":"2025-20","sprintLabel":"2025 Sprint 20","team":"Technology - SEO","committed":32,"confirmed":16,"percent":0.5,"date":"2025-10-13"},
            {"sprintId":"2025-20","sprintLabel":"2025 Sprint 20","team":"Technology - Monetization","committed":146,"confirmed":136,"percent":0.9315,"date":"2025-10-13"},
            // 2025 Sprint 21
            {"sprintId":"2025-21","sprintLabel":"2025 Sprint 21","team":"B2B - Technology","committed":257,"confirmed":153,"percent":0.5953,"date":"2025-10-27"},
            {"sprintId":"2025-21","sprintLabel":"2025 Sprint 21","team":"Technology - Sport Fan Engagement","committed":155,"confirmed":127,"percent":0.8194,"date":"2025-10-27"},
            {"sprintId":"2025-21","sprintLabel":"2025 Sprint 21","team":"Technology - SEO","committed":85,"confirmed":78,"percent":0.9176,"date":"2025-10-27"},
            {"sprintId":"2025-21","sprintLabel":"2025 Sprint 21","team":"Technology - Monetization","committed":203,"confirmed":203,"percent":1,"date":"2025-10-27"},
            // 2025 Sprint 22
            {"sprintId":"2025-22","sprintLabel":"2025 Sprint 22","team":"B2B - Technology","committed":193,"confirmed":177,"percent":0.9171,"date":"2025-11-10"},
            {"sprintId":"2025-22","sprintLabel":"2025 Sprint 22","team":"Technology - Sport Fan Engagement","committed":181,"confirmed":94,"percent":0.5193,"date":"2025-11-10"},
            {"sprintId":"2025-22","sprintLabel":"2025 Sprint 22","team":"Technology - SEO","committed":59,"confirmed":17,"percent":0.2881,"date":"2025-11-10"},
            {"sprintId":"2025-22","sprintLabel":"2025 Sprint 22","team":"Technology - Monetization","committed":229,"confirmed":205,"percent":0.8952,"date":"2025-11-10"},
            // 2025 Sprint 23
            {"sprintId":"2025-23","sprintLabel":"2025 Sprint 23","team":"B2B - Technology","committed":177,"confirmed":87,"percent":0.4915,"date":"2025-11-24"},
            {"sprintId":"2025-23","sprintLabel":"2025 Sprint 23","team":"Technology - Sport Fan Engagement","committed":224,"confirmed":208,"percent":0.9286,"date":"2025-11-24"},
            {"sprintId":"2025-23","sprintLabel":"2025 Sprint 23","team":"Technology - SEO","committed":55,"confirmed":14,"percent":0.2545,"date":"2025-11-24"},
            {"sprintId":"2025-23","sprintLabel":"2025 Sprint 23","team":"Technology - Monetization","committed":272,"confirmed":262,"percent":0.9632,"date":"2025-11-24"},
            // 2025 Sprint 24
            {"sprintId":"2025-24","sprintLabel":"2025 Sprint 24","team":"B2B - Technology","committed":120,"confirmed":109,"percent":0.9083,"date":"2025-12-08"},
            {"sprintId":"2025-24","sprintLabel":"2025 Sprint 24","team":"Technology - Sport Fan Engagement","committed":388,"confirmed":348,"percent":0.8969,"date":"2025-12-08"},
            {"sprintId":"2025-24","sprintLabel":"2025 Sprint 24","team":"Technology - SEO","committed":95,"confirmed":9,"percent":0.09,"date":"2025-12-08"},
            {"sprintId":"2025-24","sprintLabel":"2025 Sprint 24","team":"Technology - Monetization","committed":240,"confirmed":240,"percent":1,"date":"2025-12-08"},
            // 2026 Sprint 01
            {"sprintId":"2026-01","sprintLabel":"2026 Sprint 01","team":"B2B - Technology","committed":165,"confirmed":140,"percent":0.8485,"date":"2026-01-19"},
            {"sprintId":"2026-01","sprintLabel":"2026 Sprint 01","team":"Technology - Monetization","committed":217,"confirmed":9,"percent":0.0415,"date":"2026-01-19"},
            {"sprintId":"2026-01","sprintLabel":"2026 Sprint 01","team":"Technology - SEO","committed":307,"confirmed":57,"percent":0.1857,"date":"2026-01-19"},
            {"sprintId":"2026-01","sprintLabel":"2026 Sprint 01","team":"Technology - Sport Fan Engagement","committed":358,"confirmed":57,"percent":0.1592,"date":"2026-01-19"}
        ];

        // ============================================
        // CONSTANTS & STATE
        // ============================================
        const TEAM_COLORS = {
            'Technology - Monetization': '#22c55e',      // green
            'Technology - SEO': '#eab308',               // yellow
            'Technology - Sport Fan Engagement': '#8b5cf6', // purple
            'B2B - Technology': '#f97316'                // orange
        };

        const TEAM_SHORT_NAMES = {
            'Technology - Monetization': 'Monetization',
            'Technology - SEO': 'SEO',
            'Technology - Sport Fan Engagement': 'Sport Fan Engagement',
            'B2B - Technology': 'B2B'
        };

        let allSprints = [];
        let selectedTeams = new Set(Object.keys(TEAM_COLORS));
        let selectedSprintFrom = null;
        let selectedSprintTo = null;
        let charts = {};

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        function getUniqueSprints() {
            const sprintMap = new Map();
            RAW_DATA.forEach(d => {
                if (!sprintMap.has(d.sprintId)) {
                    sprintMap.set(d.sprintId, d.sprintLabel);
                }
            });
            // Sort by sprintId (YYYY-NN format sorts correctly)
            return [...sprintMap.entries()]
                .sort((a, b) => a[0].localeCompare(b[0]))
                .map(([id, label]) => ({ id, label }));
        }

        function getFilteredData() {
            return RAW_DATA.filter(d => {
                const inTeam = selectedTeams.has(d.team);
                const inRange = d.sprintId >= selectedSprintFrom && d.sprintId <= selectedSprintTo;
                return inTeam && inRange;
            });
        }

        function getFilteredSprints() {
            return allSprints.filter(s => s.id >= selectedSprintFrom && s.id <= selectedSprintTo);
        }

        function formatPercent(value) {
            return (value * 100).toFixed(1) + '%';
        }

        function getTeamName(team) {
            return TEAM_SHORT_NAMES[team] || team;
        }

        // ============================================
        // FILTER FUNCTIONS
        // ============================================
        function initFilters() {
            // Get unique sprints sorted
            allSprints = getUniqueSprints();
            
            if (allSprints.length > 0) {
                // Default: last 6 sprints
                const lastIndex = allSprints.length - 1;
                const startIndex = Math.max(0, lastIndex - 5); // 6 sprints total
                selectedSprintFrom = allSprints[startIndex].id;
                selectedSprintTo = allSprints[lastIndex].id;
            }

            // Team filters
            const teamFiltersEl = document.getElementById('teamFilters');
            const teams = Object.keys(TEAM_COLORS);
            
            // Add "All" button
            const allBtn = document.createElement('button');
            allBtn.id = 'allTeamsBtn';
            allBtn.className = 'filter-chip px-2 py-1 text-xs rounded border bg-blue-500 text-white';
            allBtn.textContent = 'Все';
            allBtn.onclick = () => {
                selectedTeams = new Set(teams);
                updateTeamFilterUI();
                updateDashboard();
            };
            teamFiltersEl.appendChild(allBtn);

            teams.forEach(team => {
                const btn = document.createElement('button');
                btn.className = 'filter-chip px-2 py-1 text-xs rounded border';
                btn.textContent = getTeamName(team);
                btn.style.borderColor = TEAM_COLORS[team];
                btn.dataset.team = team;
                btn.onclick = () => selectTeam(team);
                teamFiltersEl.appendChild(btn);
            });

            updateTeamFilterUI();

            // Sprint range filters
            const sprintFrom = document.getElementById('sprintFrom');
            const sprintTo = document.getElementById('sprintTo');
            
            allSprints.forEach(sprint => {
                const optionFrom = document.createElement('option');
                optionFrom.value = sprint.id;
                optionFrom.textContent = sprint.label;
                sprintFrom.appendChild(optionFrom);

                const optionTo = document.createElement('option');
                optionTo.value = sprint.id;
                optionTo.textContent = sprint.label;
                sprintTo.appendChild(optionTo);
            });

            sprintFrom.value = selectedSprintFrom;
            sprintTo.value = selectedSprintTo;

            sprintFrom.onchange = () => {
                selectedSprintFrom = sprintFrom.value;
                if (selectedSprintFrom > selectedSprintTo) {
                    selectedSprintTo = selectedSprintFrom;
                    sprintTo.value = selectedSprintTo;
                }
                updateDashboard();
            };

            sprintTo.onchange = () => {
                selectedSprintTo = sprintTo.value;
                if (selectedSprintTo < selectedSprintFrom) {
                    selectedSprintFrom = selectedSprintTo;
                    sprintFrom.value = selectedSprintFrom;
                }
                updateDashboard();
            };
        }

        function selectTeam(team) {
            // Select only this one team
            selectedTeams = new Set([team]);
            updateTeamFilterUI();
            updateDashboard();
        }

        function updateTeamFilterUI() {
            const allTeams = Object.keys(TEAM_COLORS);
            const allSelected = selectedTeams.size === allTeams.length;
            
            // Update "All" button state
            const allBtn = document.getElementById('allTeamsBtn');
            if (allSelected) {
                allBtn.className = 'filter-chip px-2 py-1 text-xs rounded border bg-blue-500 text-white';
            } else {
                allBtn.className = 'filter-chip px-2 py-1 text-xs rounded border bg-white text-gray-700';
            }
            
            // Update team buttons
            const buttons = document.querySelectorAll('#teamFilters button[data-team]');
            buttons.forEach(btn => {
                const team = btn.dataset.team;
                if (selectedTeams.has(team)) {
                    btn.style.backgroundColor = TEAM_COLORS[team];
                    btn.style.color = 'white';
                } else {
                    btn.style.backgroundColor = 'white';
                    btn.style.color = '#374151';
                }
            });
        }

        function resetFilters() {
            selectedTeams = new Set(Object.keys(TEAM_COLORS));
            if (allSprints.length > 0) {
                // Reset to last 6 sprints
                const lastIndex = allSprints.length - 1;
                const startIndex = Math.max(0, lastIndex - 5);
                selectedSprintFrom = allSprints[startIndex].id;
                selectedSprintTo = allSprints[lastIndex].id;
            }
            document.getElementById('sprintFrom').value = selectedSprintFrom;
            document.getElementById('sprintTo').value = selectedSprintTo;
            updateTeamFilterUI();
            updateDashboard();
        }

        // ============================================
        // CHART FUNCTIONS
        // ============================================
        function createVelocityChart() {
            const ctx = document.getElementById('velocityChart').getContext('2d');
            const data = getFilteredData();
            const sprints = getFilteredSprints();
            const teams = [...selectedTeams];

            const datasets = teams.map(team => ({
                label: getTeamName(team),
                data: sprints.map(sprint => {
                    const entry = data.find(d => d.sprintId === sprint.id && d.team === team);
                    return entry ? entry.confirmed : 0;
                }),
                backgroundColor: TEAM_COLORS[team],
                borderRadius: 4
            }));

            if (charts.velocity) charts.velocity.destroy();

            const colors = getChartColors();
            charts.velocity = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sprints.map(s => s.label.replace(/^\d{4}\s+/, '')),
                    datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { boxWidth: 12, padding: 8, color: colors.textColor } }
                    },
                    scales: {
                        x: { stacked: false, ticks: { color: colors.textColor }, grid: { color: colors.gridColor } },
                        y: { beginAtZero: true, title: { display: true, text: 'Story Points', color: colors.textColor }, ticks: { color: colors.textColor }, grid: { color: colors.gridColor } }
                    }
                }
            });
        }

        function createCompletionChart() {
            const ctx = document.getElementById('completionChart').getContext('2d');
            const data = getFilteredData();
            const sprints = getFilteredSprints();
            const teams = [...selectedTeams];

            const datasets = teams.map(team => ({
                label: getTeamName(team),
                data: sprints.map(sprint => {
                    const entry = data.find(d => d.sprintId === sprint.id && d.team === team);
                    return entry ? entry.percent * 100 : null;
                }),
                borderColor: TEAM_COLORS[team],
                backgroundColor: 'transparent',
                tension: 0.3,
                spanGaps: true
            }));

            // Add target line at 90%
            datasets.push({
                label: 'Target (90%)',
                data: sprints.map(() => 90),
                borderColor: '#9ca3af',
                borderDash: [5, 5],
                backgroundColor: 'transparent',
                pointRadius: 0
            });

            if (charts.completion) charts.completion.destroy();

            const colors = getChartColors();
            charts.completion = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sprints.map(s => s.label.replace(/^\d{4}\s+/, '')),
                    datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { boxWidth: 12, padding: 8, color: colors.textColor } }
                    },
                    scales: {
                        x: { ticks: { color: colors.textColor }, grid: { color: colors.gridColor } },
                        y: { 
                            beginAtZero: true, 
                            max: 120,
                            title: { display: true, text: '% выполнения', color: colors.textColor },
                            ticks: { callback: value => value + '%', color: colors.textColor },
                            grid: { color: colors.gridColor }
                        }
                    }
                }
            });
        }

        function createTeamComparisonChart() {
            const ctx = document.getElementById('teamComparisonChart').getContext('2d');
            const data = getFilteredData();
            const teams = [...selectedTeams];

            const teamStats = teams.map(team => {
                const teamData = data.filter(d => d.team === team);
                const avgCompletion = teamData.length > 0 
                    ? teamData.reduce((sum, d) => sum + d.percent, 0) / teamData.length * 100
                    : 0;
                const totalVelocity = teamData.reduce((sum, d) => sum + d.confirmed, 0);
                return { team, avgCompletion, totalVelocity };
            }).sort((a, b) => b.avgCompletion - a.avgCompletion);

            if (charts.teamComparison) charts.teamComparison.destroy();

            const colors = getChartColors();
            charts.teamComparison = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: teamStats.map(t => getTeamName(t.team)),
                    datasets: [{
                        label: 'Средний % выполнения',
                        data: teamStats.map(t => t.avgCompletion),
                        backgroundColor: teamStats.map(t => TEAM_COLORS[t.team]),
                        borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                title: (context) => {
                                    const stat = teamStats[context[0].dataIndex];
                                    return stat.team;
                                },
                                afterLabel: (context) => {
                                    const stat = teamStats[context.dataIndex];
                                    return `Всего SP: ${stat.totalVelocity}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: { 
                            beginAtZero: true,
                            max: 100,
                            ticks: { callback: value => value + '%', color: colors.textColor },
                            grid: { color: colors.gridColor }
                        },
                        y: { ticks: { color: colors.textColor }, grid: { color: colors.gridColor } }
                    }
                }
            });
        }

        function createTrendChart() {
            const ctx = document.getElementById('trendChart').getContext('2d');
            const data = getFilteredData();
            const sprints = getFilteredSprints();

            const totalBySprint = sprints.map(sprint => {
                const sprintData = data.filter(d => d.sprintId === sprint.id);
                return sprintData.reduce((sum, d) => sum + d.confirmed, 0);
            });

            if (charts.trend) charts.trend.destroy();

            const colors = getChartColors();
            charts.trend = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sprints.map(s => s.label.replace(/^\d{4}\s+/, '')),
                    datasets: [{
                        label: 'Суммарный Velocity',
                        data: totalBySprint,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: { ticks: { color: colors.textColor }, grid: { color: colors.gridColor } },
                        y: { 
                            beginAtZero: true,
                            title: { display: true, text: 'Total Story Points', color: colors.textColor },
                            ticks: { color: colors.textColor },
                            grid: { color: colors.gridColor }
                        }
                    }
                }
            });
        }

        // ============================================
        // UPDATE FUNCTIONS
        // ============================================
        function updateSummaryCards() {
            const data = getFilteredData();
            const sprints = getFilteredSprints();
            
            const totalConfirmed = data.reduce((sum, d) => sum + d.confirmed, 0);
            const avgCompletion = data.length > 0 
                ? data.reduce((sum, d) => sum + d.percent, 0) / data.length 
                : 0;
            const avgVelocity = sprints.length > 0 ? Math.round(totalConfirmed / sprints.length) : 0;

            document.getElementById('totalSprints').textContent = sprints.length;
            document.getElementById('avgCompletion').textContent = formatPercent(avgCompletion);
            document.getElementById('totalConfirmed').textContent = totalConfirmed.toLocaleString();
            document.getElementById('avgVelocity').textContent = avgVelocity + ' SP/sprint';
        }

        function updateDashboard() {
            updateSummaryCards();
            createVelocityChart();
            createCompletionChart();
            createTeamComparisonChart();
            createTrendChart();
        }

        // ============================================
        // THEME FUNCTIONS
        // ============================================
        function isDarkMode() {
            return document.documentElement.classList.contains('dark');
        }

        function getChartColors() {
            const dark = isDarkMode();
            return {
                textColor: dark ? '#e5e7eb' : '#374151',
                gridColor: dark ? '#374151' : '#e5e7eb',
                backgroundColor: dark ? '#1f2937' : '#ffffff'
            };
        }

        function toggleTheme() {
            const html = document.documentElement;
            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                html.classList.add('light');
                localStorage.setItem('theme', 'light');
            } else {
                html.classList.remove('light');
                html.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            }
            // Recreate charts with new theme colors
            updateDashboard();
        }

        function initTheme() {
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                document.documentElement.classList.remove('light');
                document.documentElement.classList.add('dark');
            }
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            initTheme();
            initFilters();
            updateDashboard();
        });
    </script>
</body>
</html>
